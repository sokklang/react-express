{"ast":null,"code":"import React,{useState,useEffect,useCallback,useContext}from\"react\";import{useNavigate,Link}from\"react-router-dom\";import axios from\"axios\";import{AuthContext}from\"./context/AuthContext\";// Import AuthContext\nimport\"bootstrap/dist/css/bootstrap.min.css\";import\"bootstrap/dist/js/bootstrap.min.js\";import\"font-awesome/css/font-awesome.min.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Login=()=>{const[username,setUsername]=useState(\"\");const[password,setPassword]=useState(\"\");const[errorMessage,setErrorMessage]=useState(\"\");const navigate=useNavigate();// Use the AuthContext\nconst{handleLogin,handleLogout}=useContext(AuthContext);const checkLoginStatus=useCallback(async()=>{try{const response=await axios.get(\"http://localhost:5000/api/check-login\",{withCredentials:true});const{loggedIn,user}=response.data;if(loggedIn){handleLogin(user.Username,user.FirstName,user.LastName,user.Email,user.UserID,user.RoleType,user.CompanyName,user.Address,user.Industry,user.UserRoleId,user.CompanyID);console.log(\"Login status\",response.data.loggedIn);}else{handleLogout();}}catch(error){console.error(\"Login status:\",error.response.data.loggedIn);}},[handleLogin,handleLogout]);useEffect(()=>{checkLoginStatus();},[checkLoginStatus]);const handleUserLogin=async()=>{if(!username||!password){setErrorMessage(\"Username and password are required\");return;}try{const response=await axios.post(\"http://localhost:5000/api/login\",{username,password},{withCredentials:true});const{username:loggedInUsername,firstname,lastname,email,userid,userroletype,companyname,companyaddress,companyindustry,userroleid,companyid}=response.data;// Save the token to localStorage\n//localStorage.setItem(\"token\", token);\n//localStorage.setItem(\"userid\", userid);\n//localStorage.setItem(\"userroletype\", userroletype);\n//localStorage.setItem(\"companyName\", companyName);\n//localStorage.setItem(\"UserRoleId\", UserRoleId);\nhandleLogin(loggedInUsername,firstname,lastname,email,userid,userroletype,companyname,companyaddress,companyindustry,userroleid,companyid);navigate(\"/home\");}catch(error){setErrorMessage(error.response.data.message);}};return/*#__PURE__*/_jsx(\"div\",{className:\"container mt-5\",\"data-bs-theme\":\"dark\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:\"Login\"}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"form\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",className:\"form-label\",children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter username\",className:\"form-control\",id:\"username\",value:username,onChange:e=>setUsername(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",className:\"form-label\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",autoComplete:\"on\",placeholder:\"Enter Password\",className:\"form-control\",id:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true})]}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",role:\"alert\",children:errorMessage}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:handleUserLogin,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-sign-in fa-fw me-2\"}),\"Login\"]}),/*#__PURE__*/_jsx(Link,{to:\"/register\",className:\"btn btn-link\",children:\"Register\"})]})]})})]})})})});};export default Login;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useContext","useNavigate","Link","axios","AuthContext","jsx","_jsx","jsxs","_jsxs","Login","username","setUsername","password","setPassword","errorMessage","setErrorMessage","navigate","handleLogin","handleLogout","checkLoginStatus","response","get","withCredentials","loggedIn","user","data","Username","FirstName","LastName","Email","UserID","RoleType","CompanyName","Address","Industry","UserRoleId","CompanyID","console","log","error","handleUserLogin","post","loggedInUsername","firstname","lastname","email","userid","userroletype","companyname","companyaddress","companyindustry","userroleid","companyid","message","className","children","htmlFor","type","placeholder","id","value","onChange","e","target","required","autoComplete","role","onClick","to"],"sources":["C:/Users/Administrator/Desktop/react-express/client/src/Login.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useContext } from \"react\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { AuthContext } from \"./context/AuthContext\"; // Import AuthContext\r\n\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport \"bootstrap/dist/js/bootstrap.min.js\";\r\nimport \"font-awesome/css/font-awesome.min.css\";\r\n\r\nconst Login = () => {\r\n  const [username, setUsername] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [errorMessage, setErrorMessage] = useState(\"\");\r\n  const navigate = useNavigate();\r\n  // Use the AuthContext\r\n  const { handleLogin, handleLogout } = useContext(AuthContext);\r\n\r\n  const checkLoginStatus = useCallback(async () => {\r\n    try {\r\n      const response = await axios.get(\r\n        \"http://localhost:5000/api/check-login\",\r\n        { withCredentials: true }\r\n      );\r\n      const { loggedIn, user } = response.data;\r\n\r\n      if (loggedIn) {\r\n        handleLogin(\r\n          user.Username,\r\n          user.FirstName,\r\n          user.LastName,\r\n          user.Email,\r\n          user.UserID,\r\n          user.RoleType,\r\n          user.CompanyName,\r\n          user.Address,\r\n          user.Industry,\r\n          user.UserRoleId,\r\n          user.CompanyID\r\n        );\r\n        console.log(\"Login status\", response.data.loggedIn);\r\n      } else {\r\n        handleLogout();\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Login status:\", error.response.data.loggedIn);\r\n    }\r\n  }, [handleLogin, handleLogout]);\r\n\r\n  useEffect(() => {\r\n    checkLoginStatus();\r\n  }, [checkLoginStatus]);\r\n\r\n  const handleUserLogin = async () => {\r\n    if (!username || !password) {\r\n      setErrorMessage(\"Username and password are required\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://localhost:5000/api/login\",\r\n        { username, password },\r\n        { withCredentials: true }\r\n      );\r\n\r\n      const {\r\n        username: loggedInUsername,\r\n        firstname,\r\n        lastname,\r\n        email,\r\n        userid,\r\n        userroletype,\r\n        companyname,\r\n        companyaddress,\r\n        companyindustry,\r\n        userroleid,\r\n        companyid,\r\n      } = response.data;\r\n\r\n      // Save the token to localStorage\r\n      //localStorage.setItem(\"token\", token);\r\n      //localStorage.setItem(\"userid\", userid);\r\n      //localStorage.setItem(\"userroletype\", userroletype);\r\n      //localStorage.setItem(\"companyName\", companyName);\r\n      //localStorage.setItem(\"UserRoleId\", UserRoleId);\r\n\r\n      handleLogin(\r\n        loggedInUsername,\r\n        firstname,\r\n        lastname,\r\n        email,\r\n        userid,\r\n        userroletype,\r\n        companyname,\r\n        companyaddress,\r\n        companyindustry,\r\n        userroleid,\r\n        companyid\r\n      );\r\n      navigate(\"/home\");\r\n    } catch (error) {\r\n      setErrorMessage(error.response.data.message);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mt-5\" data-bs-theme=\"dark\">\r\n      <div className=\"row justify-content-center\">\r\n        <div className=\"col-md-6\">\r\n          <div className=\"card\">\r\n            <div className=\"card-header\">Login</div>\r\n            <div className=\"card-body\">\r\n              <form>\r\n                <div className=\"mb-3\">\r\n                  <label htmlFor=\"username\" className=\"form-label\">\r\n                    Username\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Enter username\"\r\n                    className=\"form-control\"\r\n                    id=\"username\"\r\n                    value={username}\r\n                    onChange={(e) => setUsername(e.target.value)}\r\n                    required\r\n                  />\r\n                </div>\r\n                <div className=\"mb-3\">\r\n                  <label htmlFor=\"password\" className=\"form-label\">\r\n                    Password\r\n                  </label>\r\n                  <input\r\n                    type=\"password\"\r\n                    autoComplete=\"on\"\r\n                    placeholder=\"Enter Password\"\r\n                    className=\"form-control\"\r\n                    id=\"password\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    required\r\n                  />\r\n                </div>\r\n                {errorMessage && (\r\n                  <div className=\"alert alert-danger\" role=\"alert\">\r\n                    {errorMessage}\r\n                  </div>\r\n                )}\r\n                <div className=\"mb-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn btn-primary\"\r\n                    onClick={handleUserLogin}\r\n                  >\r\n                    <i className=\"fa fa-sign-in fa-fw me-2\"></i>Login\r\n                  </button>\r\n                  <Link to=\"/register\" className=\"btn btn-link\">\r\n                    Register\r\n                  </Link>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}